(function(){window.App||(window.App={}),App.LibParser=function(){function e(e,t,i,r){this.file=e,this.newTrack=t,this.progress=null!=i?i:null,this.done=null!=r?r:null,this.fileReader.addEventListener("load",function(e){return function(t){var i;return i=t.target.result,0===i.indexOf(e.delimiter)&&(i="<dict>"+i.split("</dict>",1)[0]+"</dict>",e.parseTrack(i)),-1===i.indexOf("<key>Playlists</key>")?(e.offset+=i.indexOf(e.delimiter,1),e.read()):e.finished()}}(this))}return e.prototype.chunkSize=3e3,e.prototype.offset=500,e.prototype.fileReader=new FileReader,e.prototype.file=null,e.prototype.delimiter="<key>Track ID</key>",e.prototype.read=function(){var e;return this.offset<this.file.size?(null!==this.progress&&this.progress(this.offset,this.file.size),e=this.file.slice(this.offset,this.offset+this.chunkSize),this.fileReader.readAsText(e)):this.finished()},e.prototype.valueForKeyInDoc=function(e,t){var i,r;return i=$(t).find("key").filter(function(){return $(this).text().toLowerCase()===e.toLowerCase()}),i.length>=1?(r=i.next().text().trim(),0===r.length?void 0:r):void 0},e.prototype.parseTrack=function(e){var t,i,r,o,n;return o=$.parseXML(e),i=this.valueForKeyInDoc("album artist",o),void 0===i&&(i=this.valueForKeyInDoc("artist",o)),t=this.valueForKeyInDoc("album",o),r=this.valueForKeyInDoc("bit rate",o),n="Audiobook"===this.valueForKeyInDoc("genre",o),"Various Artists"===i&&(i=void 0),n||-1!==[i,t,r].indexOf(void 0)?void 0:this.newTrack(i,t)},e.prototype.finished=function(){return null!==this.done?this.done():void 0},e}()}).call(this);